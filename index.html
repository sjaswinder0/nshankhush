<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Powered by Love</title>
    <style>
        :root {
            --dawn-orange: #fdba74;
            --dawn-pink: #f472b6;
            --text-main: #4c1d95;
            --glass-bg: rgba(25, 10, 50, 0.7);
        }
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: linear-gradient(to bottom, #1e0b42, #fb7185, #fdba74);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: white;
            touch-action: none;
        }
        #canvas-container {
            width: 100%;
            height: 100%;
            display: block;
        }
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        .message-box {
            width: 75%;
            text-align: center;
            font-size: 1.25rem;
            font-weight: 500;
            line-height: 1.5;
            opacity: 0;
            transform: translateY(30px);
            background: var(--glass-bg);
            color: #fff;
            padding: 24px;
            border-radius: 24px;
            border: 1px solid rgba(253, 186, 116, 0.4);
            backdrop-filter: blur(15px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }
        .final-message {
            position: absolute;
            top: 25%;
            width: 85%;
            text-align: center;
            opacity: 0;
            z-index: 20;
        }
        .valentine-wish {
            font-size: 1.3rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 12px;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-shadow: 0 0 15px rgba(251, 113, 133, 1);
        }
        .final-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 8px;
            color: white;
            line-height: 1.2;
        }
        .final-subtitle {
            font-size: 1.1rem;
            font-weight: 400;
            color: #fce7f3;
        }
        .footer-note {
            position: absolute;
            bottom: 30px;
            width: 100%;
            text-align: center;
            font-size: 0.75rem;
            letter-spacing: 1.5px;
            color: rgba(255, 255, 255, 0.7);
            opacity: 0;
            text-transform: uppercase;
        }
        #interaction-hint {
            position: absolute;
            bottom: 90px;
            width: 100%;
            text-align: center;
            font-size: 0.85rem;
            font-weight: 600;
            color: #fdba74;
            letter-spacing: 1px;
            animation: pulse 2.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.4; transform: scale(0.98); }
            50% { opacity: 1; transform: scale(1.02); }
        }
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <div id="ui-layer">
        <div id="message-display" class="message-box"></div>
        
        <div id="final-display" class="final-message">
            <div class="valentine-wish">Happy Valentine's Day my Love</div>
            <div class="final-title">Khush means the world to me.</div>
            <div class="final-subtitle">In every universe, I choose her.</div>
        </div>

        <div id="interaction-hint">TAP THE MECHANIC TOOLS</div>
        <div id="footer" class="footer-note">Built by a mechanic. Powered by love.</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        let scene, camera, renderer, raycaster, mouse;
        let tools = [];
        let clickedCount = 0;
        const totalTools = 5;
        let isFinalSequence = false;
        
        const messages = [
            "Like every bolt I tighten, my love for Khush grows stronger.",
            "In this garage of dreams, Khush is my masterpiece.",
            "No engine runs smoother than my heart when she smiles.",
            "I would rebuild the world just to see her happy.",
            "She is the horsepower behind my universe."
        ];

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xfb7185); 
            scene.fog = new THREE.Fog(0x1e0b42, 4, 18);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(7.5, 2.5, 6); 
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.outputEncoding = THREE.sRGBEncoding;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            setupLights();
            createEnvironment();
            createMuscleCar();
            createTools();
            createAtmosphere();

            window.addEventListener('resize', onWindowResize);
            window.addEventListener('touchstart', onTouch, { passive: false });
            window.addEventListener('mousedown', onMouseDown);

            animate();
        }

        function setupLights() {
            scene.add(new THREE.AmbientLight(0x4c1d95, 0.6));

            const sunLight = new THREE.DirectionalLight(0xfdba74, 1.8);
            sunLight.position.set(-10, 8, -5);
            scene.add(sunLight);

            const purpleRim = new THREE.PointLight(0xa855f7, 1.2, 20);
            purpleRim.position.set(5, 5, 5);
            scene.add(purpleRim);
        }

        function createEnvironment() {
            const floorGeo = new THREE.PlaneGeometry(50, 50);
            const floorMat = new THREE.MeshStandardMaterial({ 
                color: 0x1e0b42, 
                roughness: 0.1, 
                metalness: 0.8 
            });
            const floor = new THREE.Mesh(floorGeo, floorMat);
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = -1.2;
            scene.add(floor);
        }

        let carGroup;
        function createMuscleCar() {
            carGroup = new THREE.Group();
            
            const paintMat = new THREE.MeshStandardMaterial({ color: 0x4c1d95, metalness: 0.9, roughness: 0.1 });
            const windowMat = new THREE.MeshStandardMaterial({ color: 0x0a0a0a, metalness: 1, roughness: 0 });
            const tireMat = new THREE.MeshStandardMaterial({ color: 0x111111, roughness: 1 });
            const chromeMat = new THREE.MeshStandardMaterial({ color: 0xcccccc, metalness: 1, roughness: 0.1 });

            // Body
            const chassis = new THREE.Mesh(new THREE.BoxGeometry(2, 0.5, 4.5), paintMat);
            chassis.position.y = 0.25;
            carGroup.add(chassis);

            // Fastback Cabin
            const cabin = new THREE.Mesh(new THREE.BoxGeometry(1.6, 0.6, 2), windowMat);
            cabin.position.set(0, 0.75, 0.4);
            carGroup.add(cabin);

            // Hood Scoop
            const scoop = new THREE.Mesh(new THREE.BoxGeometry(0.7, 0.15, 1), paintMat);
            scoop.position.set(0, 0.55, -1);
            carGroup.add(scoop);

            // Spoiler
            const spoiler = new THREE.Mesh(new THREE.BoxGeometry(2, 0.1, 0.4), paintMat);
            spoiler.position.set(0, 0.6, 2.1);
            spoiler.rotation.x = -0.2;
            carGroup.add(spoiler);

            // Wheels
            const wheelGeo = new THREE.CylinderGeometry(0.42, 0.42, 0.3, 24);
            const rimGeo = new THREE.CylinderGeometry(0.25, 0.25, 0.32, 12);
            const wheelPos = [
                {x: -1.05, z: -1.4}, {x: 1.05, z: -1.4},
                {x: -1.05, z: 1.5}, {x: 1.05, z: 1.5}
            ];
            wheelPos.forEach(p => {
                const w = new THREE.Group();
                const tire = new THREE.Mesh(wheelGeo, tireMat);
                tire.rotation.z = Math.PI / 2;
                const rim = new THREE.Mesh(rimGeo, chromeMat);
                rim.rotation.z = Math.PI / 2;
                w.add(tire, rim);
                w.position.set(p.x, 0.1, p.z);
                carGroup.add(w);
            });

            // Headlights
            const hL = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.2, 0.1), new THREE.MeshStandardMaterial({color: 0x222222}));
            hL.position.set(-0.65, 0.35, -2.25);
            const hR = hL.clone(); hR.position.x = 0.65;
            carGroup.add(hL, hR);
            carGroup.userData.headlights = [hL, hR];

            carGroup.rotation.y = Math.PI * 0.12; 
            scene.add(carGroup);
            
            // Initial subtle bobbing
            gsap.to(carGroup.position, { y: 0.05, duration: 2, repeat: -1, yoyo: true, ease: "sine.inOut" });
        }

        function createTools() {
            const toolMat = new THREE.MeshStandardMaterial({ color: 0x999999, metalness: 1, roughness: 0.1 });
            const toolTypes = ['Wrench', 'Spanner', 'Screwdriver', 'Ratchet', 'Torque'];

            toolTypes.forEach((name, i) => {
                const group = new THREE.Group();
                
                if(name === 'Wrench') { // Crescent wrench
                    const handle = new THREE.Mesh(new THREE.BoxGeometry(0.12, 0.7, 0.06), toolMat);
                    const head = new THREE.Mesh(new THREE.TorusGeometry(0.12, 0.05, 8, 16, Math.PI * 1.4), toolMat);
                    head.position.y = 0.4;
                    head.rotation.z = Math.PI * 0.3;
                    group.add(handle, head);
                } else if(name === 'Spanner') { // Ring spanner
                    const handle = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.7, 0.06), toolMat);
                    const head = new THREE.Mesh(new THREE.TorusGeometry(0.12, 0.05, 12, 16), toolMat);
                    head.position.y = 0.4;
                    group.add(handle, head);
                } else if(name === 'Screwdriver') {
                    const handle = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.08, 0.35, 8), new THREE.MeshStandardMaterial({color: 0x4c1d95}));
                    const shaft = new THREE.Mesh(new THREE.CylinderGeometry(0.02, 0.02, 0.5, 8), toolMat);
                    shaft.position.y = 0.4;
                    const tip = new THREE.Mesh(new THREE.BoxGeometry(0.06, 0.03, 0.01), toolMat);
                    tip.position.y = 0.65;
                    group.add(handle, shaft, tip);
                } else if(name === 'Ratchet') {
                    const handle = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.7, 0.06), toolMat);
                    const head = new THREE.Mesh(new THREE.CylinderGeometry(0.15, 0.15, 0.1, 12), toolMat);
                    head.position.y = 0.4;
                    head.rotation.x = Math.PI/2;
                    const bit = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 0.15, 6), toolMat);
                    bit.position.set(0, 0.4, 0.1);
                    bit.rotation.x = Math.PI/2;
                    group.add(handle, head, bit);
                } else if(name === 'Torque') {
                    const handle = new THREE.Mesh(new THREE.BoxGeometry(0.08, 1, 0.08), toolMat);
                    const head = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.2, 0.15), toolMat);
                    head.position.y = 0.5;
                    const bit = new THREE.Mesh(new THREE.CylinderGeometry(0.06, 0.06, 0.1, 6), toolMat);
                    bit.position.set(0, 0.5, 0.1);
                    bit.rotation.x = Math.PI/2;
                    group.add(handle, head, bit);
                }

                const angle = (i / totalTools) * Math.PI * 2;
                group.position.set(Math.cos(angle) * 4, 2.5 + Math.sin(angle * 2) * 0.5, Math.sin(angle) * 4);
                group.userData = { id: i, clicked: false, originalPos: group.position.clone() };
                tools.push(group);
                scene.add(group);
            });
        }

        function createAtmosphere() {
            const geo = new THREE.BufferGeometry();
            const count = 300;
            const pos = new Float32Array(count * 3);
            for(let i=0; i<count*3; i++) pos[i] = (Math.random() - 0.5) * 25;
            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            const mat = new THREE.PointsMaterial({ color: 0xfdba74, size: 0.03, transparent: true, opacity: 0.5 });
            scene.add(new THREE.Points(geo, mat));
        }

        // --- Interaction ---
        function onMouseDown(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            checkIntersection();
        }

        function onTouch(event) {
            if (event.touches.length > 0) {
                mouse.x = (event.touches[0].clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.touches[0].clientY / window.innerHeight) * 2 + 1;
                checkIntersection();
            }
        }

        function checkIntersection() {
            if (isFinalSequence) return;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(tools, true);
            if (intersects.length > 0) {
                let obj = intersects[0].object;
                while (obj.parent && !tools.includes(obj)) obj = obj.parent;
                if (obj.userData && !obj.userData.clicked) handleToolClick(obj);
            }
        }

        function handleToolClick(tool) {
            tool.userData.clicked = true;
            clickedCount++;
            if (clickedCount === 1) gsap.to("#interaction-hint", { opacity: 0, duration: 0.5 });

            // Visual Pop
            gsap.to(tool.scale, { x: 1.8, y: 1.8, z: 1.8, duration: 0.4, ease: "back.out" });
            tool.traverse(c => { if(c.isMesh) gsap.to(c.material.emissive || {}, { r: 1, g: 0.6, b: 0.3, duration: 0.4 }); });

            // Message Animation
            const msgBox = document.getElementById('message-display');
            gsap.killTweensOf(msgBox); 
            
            const tl = gsap.timeline();
            tl.to(msgBox, { opacity: 0, y: 20, duration: 0.2, onComplete: () => {
                msgBox.innerText = messages[tool.userData.id];
            }})
            .to(msgBox, { opacity: 1, y: 0, duration: 0.5, ease: "power2.out" })
            .to(msgBox, { opacity: 0, y: -20, duration: 0.5, delay: 3, ease: "power2.in" });

            if (clickedCount === totalTools) setTimeout(startFinalSequence, 3800);
        }

        function startFinalSequence() {
            isFinalSequence = true;
            tools.forEach(t => gsap.to(t.position, { y: 15, duration: 2, ease: "power2.in" }));

            // Cinematic Camera
            gsap.to(camera.position, { x: 5.5, y: 1.8, z: 4.5, duration: 4, ease: "power2.inOut" });

            // Car Alive - Subtle Engine Vibration
            carGroup.userData.headlights.forEach(l => {
                l.material = new THREE.MeshStandardMaterial({ color: 0xffffff, emissive: 0xffffff, emissiveIntensity: 4 });
            });
            
            // Killed previous idle bobbing
            gsap.killTweensOf(carGroup.position);
            // Reduced vibration displacement (y: 0.03) and duration for a subtle "purr"
            gsap.to(carGroup.position, { y: 0.03, duration: 0.06, repeat: -1, yoyo: true, ease: "sine.inOut" });

            // Final UI
            gsap.to("#final-display", { opacity: 1, y: -15, duration: 2.5, delay: 1, ease: "power3.out" });
            gsap.to("#footer", { opacity: 1, duration: 2, delay: 4 });

            createFallingHearts();
        }

        function createFallingHearts() {
            const mat = new THREE.MeshStandardMaterial({ color: 0xffffff, transparent: true, opacity: 0.6 });
            for(let i=0; i<60; i++) {
                const p = new THREE.Mesh(new THREE.BoxGeometry(0.08, 0.08, 0.08), mat.clone());
                p.position.set((Math.random()-0.5)*15, 12, (Math.random()-0.5)*15);
                scene.add(p);
                gsap.to(p.position, { y: -2, x: p.position.x + (Math.random()-0.5)*4, duration: 5 + Math.random()*5, repeat: -1, delay: Math.random()*5 });
                gsap.to(p.rotation, { x: 6, y: 6, duration: 4, repeat: -1 });
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;
            if (!isFinalSequence) {
                tools.forEach((t, i) => {
                    if (!t.userData.clicked) {
                        t.position.y = t.userData.originalPos.y + Math.sin(time + i) * 0.25;
                        t.rotation.y += 0.015;
                        t.rotation.z = Math.sin(time * 0.5) * 0.1;
                    }
                });
            }
            renderer.render(scene, camera);
        }

        window.onload = init;
    </script>
</body>
</html>
